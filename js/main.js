const translations = {
    it: {
        pageTitle: "Matteo Cota - Portfolio Sviluppatore Web",
        metaKeywords: "Matteo Cota, Sviluppatore Web, Portfolio, Front End, Back End, Laravel, Vue.js, PHP, Javascript, Italia",
        metaDescription: "Portfolio di Matteo Cota, Sviluppatore Web specializzato in Front End e Back End. Scopri i miei progetti, competenze e contattami per collaborazioni.",
        spinnerLoading: "Caricamento...",
        nav: {
            about: "Chi sono",
            skills: "Competenze",
            projects: "Progetti",
            contact: "Contatti",
            toggle: "Attiva/disattiva navigazione",
            toggleTheme: "Cambia Tema"
        },
        hero: {
            iAm: "// Sono",
            name: "Matteo Cota",
            typedText: "Sviluppatore Web, Sviluppatore Front End, Sviluppatore Back End, Risolutore di Problemi Creativo",
            description: "Trasformo idee in codice, creando esperienze web coinvolgenti e funzionali.",
            downloadCv: "Download CV",
            contactMe: "Contattami"
        },
        about: {
            years: "Anno",
            yearsSuffix: "di esperienza nello sviluppo web",
            fullstack: "full-stack",
            description1: "Sono un web developer con una solida base nello sviluppo front-end e back-end. Mi appassiona creare soluzioni digitali",
            strongText: "performanti, intuitive e visivamente curate",
            description2: "La mia curiosità mi spinge a rimanere costantemente aggiornato sulle ultime tecnologie e best practice del settore, per trasformare idee complesse in progetti web di successo.",
            listItem1: "Siti web responsive e moderni",
            listItem2: "Applicazioni web robuste e scalabili",
            listItem3: "Attenzione ai dettagli e alla User Experience",
            viewProjectsBtn: "I Miei Progetti",
            completedProjectsCounter: "Progetti Completati con Successo",
            quote: '"Dalla landing page all\'applicazione complessa, ogni progetto è un\'opportunità per creare valore digitale."'
        },
        skills: {
            sectionTitle: "Competenze & Formazione",
            sectionSubtitle: "Ecco le tecnologie con cui lavoro e il mio percorso formativo.",
            technicalSkills: "Competenze Tecniche",
            htmlLevel: "98%",
            cssLevel: "95%",
            jsLevel: "92%",
            vueLevel: "88%",
            phpLevel: "90%",
            laravelLevel: "95%",
            otherSkills: "Altre competenze: Git, MySQL, Bootstrap, REST API, Problem Solving.",
            educationTitle: "Formazione",
            booleanExpTitle: "Full Stack Web Developer",
            booleanExpDate: "06/2024 - 12/2024 | Boolean",
            booleanExpDesc: "Corso intensivo focalizzato su tecnologie front-end (HTML, CSS, JS, Vue.js) e back-end (PHP, Laravel, MySQL).",
            googleDigitalTitle: "Concetti di base del Marketing Digitale",
            googleDigitalDate: "10/2022 | Google Digital Training",
            googleDigitalDesc: "Certificazione sulle basi del marketing online, SEO, SEM e social media marketing.",
            googleGrowTitle: "Crescere in Digitale",
            googleGrowDate: "01/2016 | Google & Unioncamere",
            googleGrowDesc: "Progetto formativo sulle competenze digitali per l'inserimento nel mondo del lavoro."
        },
        projects: {
            sectionTitle: "I Miei Progetti",
            filterAll: "Tutti",
            filterWeb: "Siti Web",
            filterApps: "Applicazioni",
            boolandoTitle: "Boolando",
            boolandoDesc: "Replica E-commerce (HTML/CSS)",
            boolandoDetail: "Vedi Dettaglio Boolando",
            boolandoVisit: "Visita il sito (link mancante)",
            boolandoCode: "Vedi Codice (link mancante)",
            boolflixTitle: "Boolflix",
            boolflixDesc: "App Catalogo Film/Serie TV (Vue.js, API)",
            boolflixDetail: "Vedi Dettaglio Boolflix",
            boolflixVisit: "Visita l'app (link mancante)",
            boolflixCode: "Vedi Codice (link mancante)",
            dcComicsTitle: "DC Comics",
            dcComicsDesc: "Sito Vetrina (Laravel)",
            dcComicsDetail: "Vedi Dettaglio DC Comics",
            dcComicsVisit: "Visita il sito (link mancante)",
            dcComicsCode: "Vedi Codice (link mancante)",
            boolbnbTitle: "BoolBnB",
            boolbnbDesc: "Piattaforma Affitti (Full Stack - Team Project)",
            boolbnbDetail: "Vedi Dettaglio BoolBnB",
            boolbnbVisit: "Visita il sito (link mancante)",
            boolbnbCode: "Vedi Codice (link mancante)",
            boolzappTitle: "Boolzapp",
            boolzappDesc: "Replica Interfaccia Chat (Vue.js)",
            boolzappDetail: "Vedi Dettaglio Boolzapp",
            boolzappVisit: "Visita l'app (link mancante)",
            boolzappCode: "Vedi Codice (link mancante)",
            spotifyTitle: "Spotify Web",
            spotifyDesc: "Replica Interfaccia Player (HTML/CSS)",
            spotifyDetail: "Vedi Dettaglio Spotify",
            spotifyVisit: "Visita il sito (link mancante)",
            spotifyCode: "Vedi Codice (link mancante)",
        },
        contact: {
             sectionTitle: "Mettiamoci in Contatto",
             sectionSubtitle: "Hai un progetto in mente o vuoi discutere una collaborazione? <br> Non esitare a scrivermi!",
             emailTitle: "Email",
             emailDesc: "Scrivimi direttamente per richieste o proposte.",
             socialTitle: "Seguimi",
             socialDesc: "Rimani aggiornato sui miei lavori e connessioni.",
             formName: "Il tuo Nome",
             formEmail: "La tua Email",
             formSubject: "Oggetto",
             formMessage: "Messaggio",
             formSend: "Invia Messaggio"
        },
        footer: {
            profileDesc: "Web Developer appassionato con sede in Italia. <br>Pronto a trasformare la tua visione digitale in realtà.",
            rights: "Tutti i diritti riservati.",
            quickLinks: "Link Rapidi",
            projects: "Progetti",
            connect: "Connettiti",
            followMe: "Seguimi sui social network:",
            emailLabel: "Email:"
        },
        
    },
    en: {
        pageTitle: "Matteo Cota - Web Developer Portfolio",
        metaKeywords: "Matteo Cota, Web Developer, Portfolio, Front End, Back End, Laravel, Vue.js, PHP, Javascript, Italy",
        metaDescription: "Portfolio of Matteo Cota, a Web Developer specializing in Front End and Back End. Discover my projects, skills, and contact me for collaborations.",
        spinnerLoading: "Loading...",
        nav: {
            about: "About Me",
            skills: "Skills",
            projects: "Projects",
            contact: "Contact",
            toggle: "Toggle navigation",
            toggleTheme: "Toggle Theme"
        },
        hero: {
            iAm: "// I Am",
            name: "Matteo Cota",
            typedText: "Web Developer, Front End Developer, Back End Developer, Creative Problem Solver",
            description: "I transform ideas into code, creating engaging and functional web experiences.",
            downloadCv: "Download CV",
            contactMe: "Contact Me"
        },
         about: {
            years: "Year",
            yearsSuffix: "of experience in web development",
            fullstack: "full-stack",
            description1: "I am a web developer with a solid foundation in front-end and back-end development. I am passionate about creating digital solutions that are",
            strongText: "performant, intuitive, and visually appealing",
            description2: "My curiosity drives me to constantly stay updated on the latest technologies and industry best practices, to turn complex ideas into successful web projects.",
            listItem1: "Responsive and modern websites",
            listItem2: "Robust and scalable web applications",
            listItem3: "Attention to detail and User Experience",
            viewProjectsBtn: "My Projects",
            completedProjectsCounter: "Successfully Completed Projects",
            quote: '"From landing pages to complex applications, every project is an opportunity to create digital value."'
        },
        skills: {
            sectionTitle: "Skills & Education",
            sectionSubtitle: "Here are the technologies I work with and my educational background.",
            technicalSkills: "Technical Skills",
            htmlLevel: "98%",
            cssLevel: "95%",
            jsLevel: "92%",
            vueLevel: "88%",
            phpLevel: "90%",
            laravelLevel: "95%",
            otherSkills: "Other skills: Git, MySQL, Bootstrap, REST API, Problem Solving.",
            educationTitle: "Education",
            booleanExpTitle: "Full Stack Web Developer",
            booleanExpDate: "06/2024 - 12/2024 | Boolean",
            booleanExpDesc: "Intensive course focused on front-end (HTML, CSS, JS, Vue.js) and back-end (PHP, Laravel, MySQL) technologies.",
            googleDigitalTitle: "Fundamentals of Digital Marketing",
            googleDigitalDate: "10/2022 | Google Digital Training",
            googleDigitalDesc: "Certification on the basics of online marketing, SEO, SEM, and social media marketing.",
            googleGrowTitle: "Grow Digital (Crescere in Digitale)",
            googleGrowDate: "01/2016 | Google & Unioncamere",
            googleGrowDesc: "Training project on digital skills for entering the job market."
        },
        projects: {
            sectionTitle: "My Projects",
            filterAll: "All",
            filterWeb: "Websites",
            filterApps: "Applications",
            boolandoTitle: "Boolando",
            boolandoDesc: "E-commerce Replica (HTML/CSS)",
            boolandoDetail: "View Boolando Detail",
            boolandoVisit: "Visit site (link missing)",
            boolandoCode: "View Code (link missing)",
            boolflixTitle: "Boolflix",
            boolflixDesc: "Movie/TV Show Catalog App (Vue.js, API)",
            boolflixDetail: "View Boolflix Detail",
            boolflixVisit: "Visit app (link missing)",
            boolflixCode: "View Code (link missing)",
            dcComicsTitle: "DC Comics",
            dcComicsDesc: "Showcase Site (Laravel)",
            dcComicsDetail: "View DC Comics Detail",
            dcComicsVisit: "Visit site (link missing)",
            dcComicsCode: "View Code (link missing)",
            boolbnbTitle: "BoolBnB",
            boolbnbDesc: "Rental Platform (Full Stack - Team Project)",
            boolbnbDetail: "View BoolBnB Detail",
            boolbnbVisit: "Visit site (link missing)",
            boolbnbCode: "View Code (link missing)",
            boolzappTitle: "Boolzapp",
            boolzappDesc: "Chat Interface Replica (Vue.js)",
            boolzappDetail: "View Boolzapp Detail",
            boolzappVisit: "Visit app (link missing)",
            boolzappCode: "View Code (link missing)",
            spotifyTitle: "Spotify Web",
            spotifyDesc: "Player Interface Replica (HTML/CSS)",
            spotifyDetail: "View Spotify Detail",
            spotifyVisit: "Visit site (link missing)",
            spotifyCode: "View Code (link missing)",
        },
         contact: {
             sectionTitle: "Let's Get In Touch",
             sectionSubtitle: "Have a project in mind or want to discuss a collaboration? <br> Feel free to write me!",
             emailTitle: "Email",
             emailDesc: "Write me directly for requests or proposals.",
             socialTitle: "Follow Me",
             socialDesc: "Stay updated on my work and connections.",
             formName: "Your Name",
             formEmail: "Your Email",
             formSubject: "Subject",
             formMessage: "Message",
             formSend: "Send Message"
        },
        footer: {
            profileDesc: "Passionate Web Developer based in Italy. <br>Ready to turn your digital vision into reality.",
            rights: "All rights reserved.",
            quickLinks: "Quick Links",
            projects: "Projects",
            connect: "Connect",
            followMe: "Follow me on social networks:",
            emailLabel: "Email:"
        },
    }
};

const getStoredTheme = () => localStorage.getItem('theme');
const setStoredTheme = theme => localStorage.setItem('theme', theme);
const getStoredLang = () => localStorage.getItem('lang') || 'it';
const setStoredLang = lang => localStorage.setItem('lang', lang);

const applyTheme = (theme) => {
    const body = document.body;
    const toggleButton = document.getElementById('darkModeToggle');
    const toggleIcon = toggleButton ? toggleButton.querySelector('i') : null;

    if (theme === 'dark') {
        body.classList.add('dark-mode');
        body.setAttribute('data-bs-theme', 'dark');
        if (toggleIcon) toggleIcon.className = 'fas fa-sun';
    } else {
        body.classList.remove('dark-mode');
        body.setAttribute('data-bs-theme', 'light');
        if (toggleIcon) toggleIcon.className = 'fas fa-moon';
    }
};

let currentTypedInstance = null;

const updateTexts = (lang) => {
    document.documentElement.lang = lang;
    const elements = document.querySelectorAll('[data-translate-key]');
    elements.forEach(el => {
        const key = el.dataset.translateKey;
        const translation = key.split('.').reduce((obj, i) => (obj ? obj[i] : null), translations[lang]);

        if (translation !== null && translation !== undefined) {
            if (el.hasAttribute('data-translate-title')) {
                 el.setAttribute('title', translation);
            } else if (el.hasAttribute('data-translate-aria-label')) {
                 el.setAttribute('aria-label', translation);
            } else if (el.hasAttribute('data-translate-placeholder')) {
                el.setAttribute('placeholder', translation);
            } else if (el.tagName === 'META') {
                 if (el.name === 'keywords') el.setAttribute('content', translation);
                 if (el.name === 'description') el.setAttribute('content', translation);
            } else if (el.tagName === 'TITLE') {
                 document.title = translation;
            } else if (el.classList.contains('typed-text')) {
                el.textContent = translation;
            }
            else {
                el.innerHTML = translation;
            }
        } else {
            console.warn(`Missing translation for key: ${key} in language: ${lang}`);
        }
    });

    const langDisplay = document.getElementById('currentLangDisplay');
    if (langDisplay) {
        langDisplay.textContent = lang.toUpperCase();
    }

    const typedOutput = document.querySelector('.typed-text-output');
    const typedStringsContainer = document.querySelector('.typed-text');

    if (typedOutput && typedStringsContainer) {
        if (currentTypedInstance) {
            currentTypedInstance.destroy();
        }
        const newStrings = typedStringsContainer.textContent.split(',').map(s => s.trim());

         currentTypedInstance = new Typed('.typed-text-output', {
             strings: newStrings.length > 0 && newStrings[0] !== "" ? newStrings : [' '],
             typeSpeed: 80,
             backSpeed: 40,
             backDelay: 1500,
             smartBackspace: false,
             loop: true,
             showCursor: true,
             cursorChar: '|',
         });
    }
};

document.addEventListener('DOMContentLoaded', () => {
    let currentTheme = getStoredTheme();
    if (!currentTheme) {
        currentTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }
    applyTheme(currentTheme);

    const currentLang = getStoredLang();
    updateTexts(currentLang);

    const darkModeToggle = document.getElementById('darkModeToggle');
    if (darkModeToggle) {
        darkModeToggle.addEventListener('click', () => {
            const newTheme = document.body.classList.contains('dark-mode') ? 'light' : 'dark';
            applyTheme(newTheme);
            setStoredTheme(newTheme);
        });
    }

    const langSwitches = document.querySelectorAll('.lang-switch');
    langSwitches.forEach(button => {
        button.addEventListener('click', () => {
            const newLang = button.dataset.lang;
            if (newLang !== getStoredLang()) {
                setStoredLang(newLang);
                updateTexts(newLang);
                const dropdownToggle = document.getElementById('languageDropdown');
                const dropdownInstance = bootstrap.Dropdown.getInstance(dropdownToggle);
                if (dropdownInstance) {
                     dropdownInstance.hide();
                }
            }
        });
    });

});


document.addEventListener('DOMContentLoaded', () => {
    // ... (codice esistente per tema e lingua) ...

    // 5. Inizializza Animazioni di Scroll Personalizzate
    const initScrollAnimations = () => {
        const animatedElements = document.querySelectorAll('[data-animate]');
        if (typeof Waypoint === 'function') { // Controlla se Waypoints è caricato
            animatedElements.forEach(el => {
                new Waypoint({
                    element: el,
                    handler: function(direction) {
                        if (direction === 'down' || direction === 'up') { // Attiva sia scendendo che salendo (opzionale)
                           el.classList.add('is-visible');
                           this.destroy(); // Importante: Distrugge il waypoint dopo l'attivazione per evitare ri-animazioni
                        }
                    },
                    offset: '85%' // Attiva quando l'85% dell'elemento è visibile (puoi regolare)
                });
            });
        } else {
            console.warn('Waypoints library not found. Scroll animations disabled.');
            // Fallback: Rendi subito visibili gli elementi se Waypoints non c'è
            animatedElements.forEach(el => el.classList.add('is-visible'));
        }
    };
    initScrollAnimations(); // Chiama la funzione


    // Qui inizia il resto del tuo codice JS originale dentro la IIFE
   
});




(function ($) {
    "use strict";

    var spinner = function () {
        setTimeout(function () {
            if ($('#spinner').length > 0) {
                $('#spinner').removeClass('show');
            }
        }, 500);
    };
    spinner();

    new WOW().init();

    var MQL = 992;
    var navbar = $('.navbar.fixed-top');

    function handleNavbarScroll() {
         if ($('#navbarCollapse').hasClass('show')) {
             if (!navbar.hasClass('navbar-scrolled')) {
                  navbar.addClass('navbar-scrolled');
             }
             return;
         }

        if ($(window).scrollTop() > 100) {
             if (!navbar.hasClass('navbar-scrolled')) {
                 navbar.hide().addClass('navbar-scrolled').fadeIn('slow');
             }
        } else {
             if (navbar.hasClass('navbar-scrolled')) {
                 navbar.removeClass('navbar-scrolled');
             }
        }
    }

     if ($(window).width() >= MQL) {
         handleNavbarScroll();
         $(window).scroll(handleNavbarScroll);
     } else {
         navbar.addClass('navbar-scrolled');
     }

     $(window).resize(function() {
         if ($(window).width() >= MQL) {
            handleNavbarScroll();
            $(window).on('scroll', handleNavbarScroll);
         } else {
             navbar.addClass('navbar-scrolled');
             $(window).off('scroll', handleNavbarScroll);
         }
     });

     $('#navbarCollapse').on('show.bs.collapse', function () {
         if (!navbar.hasClass('navbar-scrolled')) {
             navbar.addClass('navbar-scrolled');
         }
     });
      $('#navbarCollapse').on('hidden.bs.collapse', function () {
          handleNavbarScroll();
      });


    $(".navbar-nav a, .footer-link[href^='#'], a.btn[href^='#']").on('click', function (event) {
        if (this.hash !== "") {
            event.preventDefault();
            var hash = this.hash;
            var offsetTop = $(hash).length ? $(hash).offset().top : 0;
            var navbarHeight = $('.navbar.fixed-top').outerHeight() || 0;

            $('html, body').animate({
                scrollTop: offsetTop - navbarHeight - 10
            }, 800, 'easeInOutExpo', function(){
               $(hash).blur();
               if ($('.navbar-toggler').is(':visible')) {
                    $('.navbar-collapse').collapse('hide');
               }
            });

            if ($(this).parents('.navbar-nav').length) {
                $('.navbar-nav .active').removeClass('active');
                $(this).closest('a.nav-link').addClass('active');
            }
        }
    });

     $(window).on('scroll', function() {
        var scrollDistance = $(window).scrollTop();
        var navbarHeight = $('.navbar.fixed-top').outerHeight() || 0;
        var currentSection = null;

        $('section[id]').each(function() {
            // Ensure offset().top exists before accessing it
            if ($(this).length && typeof $(this).offset() !== 'undefined') {
                var sectionTop = $(this).offset().top - navbarHeight - 50;
                var sectionBottom = sectionTop + $(this).outerHeight();

                if (scrollDistance >= sectionTop && scrollDistance < sectionBottom) {
                    currentSection = '#' + $(this).attr('id');
                }
            }
        });

        // Check if #about exists before accessing its offset
        var aboutOffsetTop = $('#about').length && typeof $('#about').offset() !== 'undefined' ? $('#about').offset().top / 2 : 500;

        if (!currentSection && scrollDistance < aboutOffsetTop) {
            $('.navbar-nav a.active').removeClass('active');
             const homeLink = $('.navbar-nav a[href="index.html"]').first(); // Prefer index.html or the first brand link
             if (homeLink.length) {
                 homeLink.closest('.nav-item').find('.nav-link').add(homeLink).addClass('active');
             } else {
                  // Fallback if no specific home link found, activate the first nav item maybe
                  $('.navbar-nav .nav-item:first-child .nav-link').addClass('active');
             }

        } else if (currentSection) {
             $('.navbar-nav a.active').removeClass('active');
             $('.navbar-nav a[href="' + currentSection + '"]').addClass('active');
        }

    }).scroll();


    $(window).scroll(function () {
        if ($(this).scrollTop() > 300) {
            $('.back-to-top').fadeIn('slow').css('display', 'inline-flex');
        } else {
            $('.back-to-top').fadeOut('slow');
        }
    });
    $('.back-to-top').click(function (e) {
        e.preventDefault();
        $('html, body').animate({scrollTop: 0}, 1000, 'easeInOutExpo');
        return false;
    });


    var $videoSrc;
    $('.btn-play').click(function () {
        $videoSrc = $(this).data("src");
    });
    $('#videoModal').on('shown.bs.modal', function (e) {
        if ($videoSrc) {
           $("#video").attr('src', $videoSrc + "?autoplay=1&modestbranding=1&showinfo=0&rel=0");
        }
    });
    $('#videoModal').on('hide.bs.modal', function (e) {
        $("#video").attr('src', '');
    });


    var counterElement = $('[data-toggle="counter-up"]');
    if (counterElement.length) {
         if (!counterElement.data('counterup-initialized')) {
            counterElement.counterUp({
                delay: 10,
                time: 1500
            });
            counterElement.data('counterup-initialized', true);
         }
    }


    var skillSection = $('#skill');
    if (skillSection.length) {
        var skillsAnimated = false;
        skillSection.waypoint(function (direction) {
            if (direction === 'down' && !skillsAnimated) {
                $('.progress .progress-bar').each(function () {
                    $(this).css("width", $(this).attr("aria-valuenow") + '%');
                });
                skillsAnimated = true;
            }
        }, { offset: '80%' });

         setTimeout(function(){
             // Check if skillSection exists and has offset before accessing top
             if (!skillsAnimated && skillSection.length && typeof skillSection.offset() !== 'undefined' && skillSection.offset().top < $(window).height() * 0.8) {
                 $('.progress .progress-bar').each(function () {
                    $(this).css("width", $(this).attr("aria-valuenow") + '%');
                });
                skillsAnimated = true;
             }
         }, 500);
    }


    var portfolioContainer = $('.portfolio-container');
    if (portfolioContainer.length) {
        var portfolioIsotope;

        portfolioContainer.imagesLoaded( function() {
             portfolioIsotope = portfolioContainer.isotope({
                itemSelector: '.portfolio-item',
                layoutMode: 'fitRows',
                transitionDuration: '0.6s'
            });
        });


        $('#portfolio-flters li').on('click', function () {
            if (!$(this).hasClass('active')) {
                $("#portfolio-flters li").removeClass('active');
                $(this).addClass('active');

                if (portfolioIsotope) {
                     portfolioIsotope.isotope({ filter: $(this).data('filter') });
                }
            }
        });

        if (typeof lightbox !== 'undefined') {
            lightbox.option({
              'resizeDuration': 200,
              'wrapAround': true,
              'fadeDuration': 300,
              'imageFadeDuration': 300,
              'disableScrolling': true
            });
        }
    }

    $('#current-year').text(new Date().getFullYear());

})(jQuery);